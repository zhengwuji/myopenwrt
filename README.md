# luci-app-proxy-upgrade

OpenWrt 代理升级插件 (Proxy Upgrade Plugin)

这是一个 OpenWrt LuCI 插件，允许你使用局域网内的其他设备（如运行 Clash/v2ray 的电脑或手机）作为代理服务器，帮助 OpenWrt 系统进行软件更新、安装包管理或系统升级。

## 主要功能 (Features)

*   **设备自动发现**: 自动扫描局域网内的活跃设备（基于 ARP 和 DHCP），无需手动输入 IP。
*   **智能设备识别**: 根据 MAC 地址厂商（OUI）和 DHCP 主机名，自动识别设备类型（如 iPhone, 小米手机, Windows 电脑等）。
*   **多协议支持**: 支持 HTTP 和 SOCKS5 代理协议。
    *   针对 SOCKS5 自动启用 `socks5h://` (远程 DNS 解析)，解决 SSL 握手失败问题。
*   **连接测试**: 内置一键测试功能，验证代理配置是否可用，并提供详细的错误诊断（如连接被拒绝、超时、SSL 错误等）。
*   **全局代理模式 (Global Proxy)**:
    *   可选择开启“出口设置 (全局代理)”。
    *   开启后，自动配置系统环境变量 (`http_proxy`, `https_proxy`) 和 `opkg` 代理设置。
    *   使 OpenWrt 自身的所有流量（包括 `curl`, `wget`, `opkg install`）都走代理，解决系统无法更新的问题。
*   **友好界面**: 提供详细的功能说明和使用举例，新手也能轻松上手。

## 安装 (Installation)

1.  下载最新的 `.ipk` 文件。
2.  上传到 OpenWrt 路由器。
3.  执行安装命令：
    ```bash
    opkg install luci-app-proxy-upgrade_*.ipk
    ```
4.  重启 LuCI 或路由器。

## 使用方法 (Usage)

1.  进入 OpenWrt 后台，找到 **系统 (System)** -> **代理升级 (Proxy Upgrade)**。
2.  **启用代理**: 勾选“启用代理”。
3.  **选择代理服务器**: 在下拉列表中选择局域网内运行代理软件的设备。
4.  **输入端口**: 输入代理软件的监听端口（例如 Clash 默认为 7890）。
5.  **测试连接**: 点击“测试”按钮，确保显示绿色的“连接成功”。
6.  **开始升级/使用**:
    *   如果只是为了运行升级脚本，直接点击“升级”。
    *   如果需要安装其他软件（如 `opkg install`），请勾选 **“出口设置 (全局代理)”** 并保存，使用完毕后建议关闭。

## 常见问题 (FAQ)

*   **Q: SOCKS5 测试失败，提示 SSL 错误？**
    *   A: 插件已自动修复此问题，强制使用远程 DNS 解析。如果仍失败，请检查电脑防火墙是否允许了端口入站连接。
*   **Q: 全局代理开启后，局域网其他设备无法上网？**
    *   A: 此插件的全局代理仅针对 OpenWrt **自身** 的流量，不会影响连接到路由器的其他设备。

## License

MIT